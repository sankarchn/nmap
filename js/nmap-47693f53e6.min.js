"use strict";function Spot(e){this.id=e.id,this.name=e.name,this.position=new Position(e.lat,e.lng),this.category=e.category,this.address=e.address}function Position(e,t){this.lat=parseFloat(e),this.lng=parseFloat(t)}function ListItem(e,t){this.id=e,this.name=t,this.isVisible=ko.observable(!0),this.clickStatus=ko.observable(!1)}function bakeMyMap(){fsquare.fetchSpots(myCity.location,function(e,t){e===FETCH_SUCCESS?(Gmap.init(mapDiv,myCity.location,MAP_ZOOM_LEVEL,vModel),_.each(spotsDb.getAllSpots(),function(e,t){vModel.addSpot(t),Gmap.addMarker(t)}),Gmap.showAllMarkers(),vModel.notifySpotEvent(FETCH_SUCCESS,t)):vModel.notifySpotEvent(FETCH_FAIL,t)})}function launch(){Gmap.geoCode(myCity.name,function(e,t){"OK"===t?(myCity.location={lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()},drawMyMap()):vModel.notifySpotEvent(FETCH_FAIL,"Geocode was not successful for the following reason: "+t)})}function launchError(){vModel||(vModel=ListView.getVmodel(myCity.name,fsquare.getName())),vModel.notifySpotEvent(FETCH_FAIL,"Unable to load Google Maps.")}function gm_authFailure(){vModel||(vModel=ListView.getVmodel(myCity.name,fsquare.getName())),vModel.notifySpotEvent(FETCH_FAIL,"Google Maps server authentication failed")}function getDeviceType(){var e=window.screen.width;return e<=MOBILE_MAXWIDTH?PHONE_FORM:e<=TAB_MAXWIDTH?TAB_FORM:DESKTOP_FORM}var myCity={name:"Chennai",location:{}},vModel,mapDiv,ITEM_CLICKED=100,ITEM_UNCLICKED=200,ITEM_HIDDEN=300,ITEM_REVEALED=400,MARKER_CLICKED=500,MARKER_UNCLICKED=600,MARKER_HIDDEN=700,MARKER_REVEALED=800,RESTORE_ALL=900,FETCH_SUCCESS=1,FETCH_FAIL=0,MAP_ZOOM_LEVEL=14,MOBILE_MAXWIDTH=450,TAB_MAXWIDTH=768,PHONE_FORM=10,TAB_FORM=20,DESKTOP_FORM=30;Spot.prototype.getName=function(){return this.name},Spot.prototype.getPosition=function(){return this.position},Spot.prototype.getID=function(){return this.id},Spot.prototype.getCategory=function(){return this.category},Spot.prototype.getAddress=function(){return this.address},Position.prototype.getLat=function(){return this.lat},Position.prototype.getLng=function(){return this.lng};var spotsDb={spots:{},addSpot:function(e,t){this.spots[e]=t},getSpot:function(e){return this.spots[e]},getAllSpots:function(){return this.spots}},sample=function(){var e=[{id:0,name:"Marina Beach",lat:"13.047662900808886",lng:"80.2806979251197"},{id:1,name:"Anna Nagar Tower Park",lat:"13.086571414111077",lng:"80.21362675131819"},{id:2,name:"Chitlapakam lake",lat:"12.933315880239075",lng:"80.13799263592671"},{id:3,name:"Thiruvanmiyur Beach",lat:"12.980722245625548",lng:"80.26800155639648"},{id:4,name:"Valluvar kottam",lat:"13.052757448973187",lng:"80.24267129698562"},{id:5,name:"Besant Nagar Beach (Edward Elliot's Beach)",lat:"13.000506258411747",lng:"80.27084040530782"},{id:6,name:"PVR - The Grand Mall Velachery",lat:"12.972083447836322",lng:"80.21869787142035"},{id:7,name:"AGS Cinemas, T. Nagar",lat:"13.047377851967205",lng:"80.24509984915464"},{id:8,name:"Sathyam Cinemas",lat:"13.055687857317821",lng:"80.25809632255645"},{id:9,name:"Escape Cinemas",lat:"13.058725377915014",lng:"80.26413380533735"},{id:10,name:"Forum Vijaya Mall",lat:"13.05029938745061",lng:"80.20947594272806"},{id:11,name:"M A Chidambaram Stadium",lat:"13.062830126112663",lng:"80.27923923698869"},{id:12,name:"Abirami Mega Mall",lat:"13.085838514881411",lng:"80.24798570645463"},{id:13,name:"Music Academy",lat:"13.045824692206624",lng:"80.25964792592062"},{id:14,name:"Kapaleeswarar Temple",lat:"13.0336342",lng:"80.2701988"},{id:15,name:"Kalikambal Temple",lat:"13.09455",lng:"80.2891"}],t=function(){for(var t=0;t<e.length;t++)spotsDb.addSpot(t,new Spot(e[t]))};return{fetchSpots:t}}();ListItem.prototype.getName=function(){return this.name},ListItem.prototype.getID=function(){return this.id},ListItem.prototype.isClicked=function(){return this.clickStatus()},ListItem.prototype.setClicked=function(e){this.clickStatus(e)},ListItem.prototype.setVisibility=function(e){this.isVisible(e)};var ListView=function(){function e(e,t){return null!=o?o:(o=new d(e,t),ko.applyBindings(o),o)}var t=null,o=null,n=!0,i=!1,a=!0,s=!1,r=_.template("<h2><%= mycount %> spots found in <%= mycity %> using <%= myprovider %> APIs<hr></h2>"),l=_.template("<h2>Unable to retrieve places data using <%= provider %>. <br><br>Reason: <%= reason %>.</h2>"),p=_.template('<h3><%= count %> spots match pattern "<%= patstr %>"</h3>'),d=function(e,o){function d(e){var t,o,n=u.spItemList().length;for(o=0;o<n;o++)if(t=u.spItemList()[o],t.getID()==e)return t;return null}function c(e,t,o){e.setVisibility(t),e.setClicked(o)}var u=this;u.cityName=ko.observable(e),u.pgHeader="Explore "+e,u.providerName=o,u.providerFail=ko.observable(!1),u.failReason="",u.spItemList=ko.observableArray(),u.inputStr=ko.observable(""),u.patString="",u.showFiltResults=ko.observable(!1),u.matches=ko.observable(0),u.drawingMode=ko.observable(!1),u.listCounter=ko.observable(0),u.filtResult=ko.computed(function(){return u.showFiltResults()?p({count:u.matches(),patstr:u.patString}):""}),u.listWidth=ko.observable("0"),u.listShow=ko.observable("block"),u.closeList=function(){u.listShow("none")},u.openList=function(){u.listShow("block")},u.dType=getDeviceType(),u.dType!==TAB_FORM&&u.dType!==PHONE_FORM||u.closeList(),u.loadFail=ko.computed(function(){if(u.providerFail())return u.dType!==TAB_FORM&&u.dType!==PHONE_FORM||u.openList(),l({provider:u.providerName,reason:u.failReason})}),u.loadSuccess=ko.computed(function(){return r({mycount:u.listCounter(),mycity:u.cityName(),myprovider:u.providerName})}),u.inpChange=function(){u.showFiltResults(!1),u.filterList()},u.addSpot=function(e){var t,o;t=new ListItem(e,spotsDb.getSpot(e).getName()),o=_.sortedIndex(u.spItemList(),t,"name"),u.spItemList.splice(o,0,t),u.listCounter(u.listCounter()+1)},u.listClickfn=function(e,o){var i=t;e.isClicked()?(c(e,n,s),Gmap.notify(ITEM_UNCLICKED,e.getID()),t=null):(null!=i&&c(i,n,s),c(e,n,a),Gmap.notify(ITEM_CLICKED,e.getID()),t=e,u.dType==PHONE_FORM&&u.closeList())},u.notify=function(e,o){var r,l,p,g=o;switch(e){case MARKER_CLICKED:l=d(g),t!=l&&null!=t&&c(t,n,s),c(l,n,a),t=l;break;case MARKER_UNCLICKED:l=d(g),c(l,n,s),t=null;break;case MARKER_HIDDEN:l=d(g),c(l,i,s);break;case MARKER_REVEALED:l=d(g),c(l,n,s);break;case RESTORE_ALL:for(r=u.spItemList().length,p=0;p<r;p++)l=u.spItemList()[p],c(l,n,s);u.inputStr(""),u.showFiltResults(!1),u.drawingMode(!1)}},u.notifySpotEvent=function(e,t){switch(e){case FETCH_FAIL:u.failReason=t,u.providerFail(!0);break;case FETCH_SUCCESS:u.providerFail(!1)}},u.updateFilterResult=function(e,t){u.dType!==TAB_FORM&&u.dType!==PHONE_FORM||u.openList(),u.matches(e),u.patString=t,u.inputStr(""),u.showFiltResults(!0),u.drawingMode(!0)},u.filterList=function(){var e,t=u.inputStr(),o=0;e=new RegExp(t,"i"),_.each(u.spItemList(),function(t){t.getName().search(e)==-1?(c(t,i,s),Gmap.notify(ITEM_HIDDEN,t.getID())):(c(t,n,s),Gmap.notify(ITEM_REVEALED,t.getID()),o++)}),0==t.length?u.showFiltResults(!1):(u.matches(o),u.patString=u.inputStr(),u.showFiltResults(!0))}};return{getVmodel:e}}(),Gmap=function(){function e(e,t,o,n){f=new google.maps.Map(e,{center:t,zoom:o,mapTypeControl:!1,scaleControl:!0,disableDoubleClickZoom:!0,draggable:!0,styles:S}),C={},y=new google.maps.LatLngBounds,h=new google.maps.InfoWindow,h.addListener("closeclick",s),E=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:["polygon"]}}),E.setMap(f),E.addListener("overlaycomplete",u),f.addListener("dblclick",c),M=new google.maps.StreetViewService,v=n,google.maps.event.addDomListener(window,"resize",function(){var e=y.getCenter();google.maps.event.trigger(f,"resize"),f.setCenter(e)})}function t(e){var t,o;o=spotsDb.getSpot(e),t=new google.maps.Marker({position:o.getPosition(),animation:google.maps.Animation.DROP,draggable:!1,id:e,title:o.getName()}),t.setIcon(l()),y.extend(t.position),C[e]=t,t.addListener("mouseover",function(){this.setIcon(p())}),t.addListener("mouseout",function(){h.marker!=this&&this.setIcon(l())}),t.addListener("click",function(){a(this.id)})}function o(){var e=1;f.fitBounds(y),f.setCenter(y.getCenter()),_.each(C,function(t){window.setTimeout(function(e,t){return function(){e.setIcon(l()),e.setMap(t)}}(t,f),50*e++)})}function n(e){_.has(C,e)&&C[e].setMap(f)}function i(e){_.has(C,e)&&C[e].setMap(null)}function a(e){var t;_.has(C,e)&&(t=C[e],null!=h.marker&&(h.marker.setIcon(l()),v.notify(MARKER_UNCLICKED,h.marker.id)),t.setIcon(p()),h.marker=t,h.setContent(r(e)),h.open(f,t),v.notify(MARKER_CLICKED,h.marker.id))}function s(){h.setContent(""),h.close(),null!=h.marker&&(h.marker.setIcon(l()),v.notify(MARKER_UNCLICKED,h.marker.id),h.marker=null),f.setCenter(y.getCenter())}function r(e){var t=spotsDb.getSpot(e),o=C[e],n=100,i=_.template("<h2><%= title %></h2><h3><%= category %></h3><hr><h4><%= address %></h4><hr><h4>StreetView Image (Provider: Google)</h4><div <%= panoId %></div>"),a=i({title:t.getName(),category:t.getCategory(),address:t.getAddress().toString(),panoId:"id='pano'"});return M.getPanoramaByLocation(o.position,n,function(e,n){if(n==google.maps.StreetViewStatus.OK){var s=e.location.latLng,r=google.maps.geometry.spherical.computeHeading(s,o.position),l={position:s,pov:{heading:r,pitch:0}};new google.maps.StreetViewPanorama(document.getElementById("pano"),l)}else a=i({title:t.getName(),category:t.getCategory(),address:t.getAddress().toString(),panoId:""}),h.setContent(a+"<div>No StreetView image could be found for this location.</div>")}),a}function l(){var e={url:"https://chart.googleapis.com/chart?chst=d_map_xpin_letter&chld=pin|$|\tcd7d7d|FFFFFF",size:new google.maps.Size(21,34),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(21,34),scaledSize:new google.maps.Size(21,34)};return e}function p(){var e={url:"https://chart.googleapis.com/chart?chst=d_map_xpin_letter&chld=pin_star|$|7da5cd|FFFFFF",size:new google.maps.Size(23,39),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(23,39),scaledSize:new google.maps.Size(23,39)};return e}function d(e,t){switch(e){case ITEM_CLICKED:a(t);break;case ITEM_UNCLICKED:s();break;case ITEM_HIDDEN:i(t);break;case ITEM_REVEALED:n(t)}}function c(){I&&I.setMap(null),E.setDrawingMode(null),s(),v.notify(RESTORE_ALL),o()}function u(e){I&&I.setMap(null),E.setDrawingMode(null),I=e.overlay,I.setEditable(!0),g(),I.getPath().addListener("set_at",g),I.getPath().addListener("insert_at",g),I.getPath().addListener("remove_at",g)}function g(){var e=0,t=google.maps.geometry.spherical.computeArea(I.getPath());_.each(C,function(t){google.maps.geometry.poly.containsLocation(t.position,I)?(t.setMap(f),v.notify(MARKER_REVEALED,t.id),e++):(t.setMap(null),v.notify(MARKER_HIDDEN,t.id))}),s(),t=(t/1e6).toFixed(2),v.updateFilterResult(e," for city area (approx) "+t+" sq.km")}function m(e,t){var o=new google.maps.Geocoder;o.geocode({address:e},function(e,o){t(e,o)})}var f,y,h,E,M,v,C={},I=null,S=[{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#e0efef"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{hue:"#1900ff"},{color:"#c0e8e8"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"on"},{lightness:700}]},{featureType:"water",elementType:"all",stylers:[{color:"#7dcdcd"}]}];return{init:e,addMarker:t,showAllMarkers:o,notify:d,geoCode:m}}(),fsquare=function(){function e(e,p){t+="?"+$.param({ll:e.lat+","+e.lng,radius:1e5,categoryId:i+","+s+","+a+","+r+","+l,limit:16,intent:"browse",client_id:o,client_secret:n,v:"20170107"}),$.getJSON(t).done(function(e,t,o){var n=e.response.venues;_.each(n,function(e){var t=new Spot({id:e.id,name:e.name,category:e.categories[0].name,lat:e.location.lat,lng:e.location.lng,address:e.location.formattedAddress});spotsDb.addSpot(e.id,t)}),p(FETCH_SUCCESS)}).fail(function(e,t,o){p(FETCH_FAIL,"Error: "+e.status+","+t)})}var t="https://api.foursquare.com/v2/venues/search",o="LTP044CWAOZBWYQANA30G0RFMEUIPNKQQUTAKX1TJI5QVU2H",n="3N2QDLDYIHRQBIZSR3UX4TLXWIHXJNPU43DEUC02C5SVRSTJ",i="4d4b7105d754a06377d81259",a="4d4b7105d754a06378d81259",s="4d4b7105d754a06374d81259",r="4d4b7104d754a06370d81259",l="4d4b7105d754a06379d81259";return{fetchSpots:e,getName:function(){return"Foursquare"}}}(),drawMyMap=_.after(2,bakeMyMap);$(document).ready(function(){vModel=ListView.getVmodel(myCity.name,fsquare.getName()),mapDiv=$("#map")[0],drawMyMap()});
//# sourceMappingURL=http://192.168.1.40:8081/maps/nmap.min.js.map
